<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AWS Solution Architect Associate ë¬¸ì œí’€ì´</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
      background: #f9fafb;
      color: #111827;
      padding: 1rem;
      line-height: 1.6;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    /* í—¤ë” */
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 2rem;
      border-radius: 12px;
      margin-bottom: 2rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      font-size: 1.8rem;
      font-weight: 600;
      text-align: center;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 1rem;
    }

    .user-badge {
      background: rgba(255,255,255,0.2);
      border: 1px solid rgba(255,255,255,0.3);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.85rem;
      color: white;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .user-badge button {
      background: none;
      border: none;
      color: rgba(255,255,255,0.7);
      cursor: pointer;
      padding: 0;
      font-size: 1rem;
    }

    .user-badge button:hover {
      color: white;
    }

    .sync-status {
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .sync-status.syncing { color: #fcd34d; }
    .sync-status.success { color: #86efac; }
    .sync-status.error { color: #fca5a5; }
    .sync-status.offline { color: #9ca3af; }

    /* ë¡œë”© */
    .loading {
      text-align: center;
      padding: 3rem;
      font-size: 1.2rem;
      color: #667eea;
    }

    /* ëª¨ë“œ ì„ íƒ íŒ¨ë„ */
    .mode-panel {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 1.5rem;
    }

    .mode-panel h3 {
      font-size: 1rem;
      color: #374151;
      margin-bottom: 1rem;
    }

    .mode-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .mode-btn {
      padding: 0.6rem 1.2rem;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      font-size: 0.9rem;
      font-family: inherit;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .mode-btn:hover {
      border-color: #667eea;
      background: #f5f3ff;
    }

    .mode-btn.active {
      border-color: #667eea;
      background: #667eea;
      color: white;
    }

    .mode-btn .count {
      font-size: 0.75rem;
      background: rgba(0,0,0,0.1);
      padding: 0.15rem 0.4rem;
      border-radius: 10px;
    }

    .mode-btn.active .count {
      background: rgba(255,255,255,0.2);
    }

    /* í†µê³„ ì¹´ë“œ */
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .stat-card {
      background: white;
      padding: 1.2rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .stat-card h3 {
      font-size: 0.8rem;
      color: #6b7280;
      margin-bottom: 0.3rem;
    }

    .stat-card p {
      font-size: 1.5rem;
      font-weight: 700;
      color: #667eea;
    }

    /* í€´ì¦ˆ ì»¨í…Œì´ë„ˆ */
    .quiz-container {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 1.5rem;
    }

    progress {
      width: 100%;
      height: 12px;
      margin-bottom: 0.5rem;
      border-radius: 8px;
      overflow: hidden;
      appearance: none;
    }

    progress::-webkit-progress-bar {
      background-color: #e5e7eb;
      border-radius: 8px;
    }

    progress::-webkit-progress-value {
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      border-radius: 8px;
    }

    progress::-moz-progress-bar {
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      border-radius: 8px;
    }

    .progress-info {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: #6b7280;
      margin-bottom: 1.5rem;
    }

    .service-tags {
      display: flex;
      gap: 0.4rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .service-tag {
      background: #dbeafe;
      color: #1d4ed8;
      padding: 0.25rem 0.6rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .question {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      color: #1f2937;
      line-height: 1.8;
    }

    .choice-button {
      display: block;
      width: 100%;
      text-align: left;
      padding: 1rem 1.25rem;
      margin: 0.75rem 0;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.2s ease;
      color: #374151;
      font-family: inherit;
    }

    .choice-button:hover:not(:disabled) {
      background: #f9fafb;
      border-color: #d1d5db;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .choice-button.selected {
      border-color: #3b82f6;
      background-color: #eff6ff;
      font-weight: 500;
    }

    .choice-button.correct {
      background-color: #d1fae5;
      border-color: #10b981;
      color: #065f46;
      font-weight: 600;
    }

    .choice-button.incorrect {
      background-color: #fee2e2;
      border-color: #ef4444;
      color: #991b1b;
      font-weight: 600;
    }

    .choice-button:disabled {
      cursor: not-allowed;
    }

    .answer-section {
      background: #f0fdf4;
      border: 2px solid #10b981;
      border-radius: 8px;
      padding: 1.5rem;
      margin-top: 1.5rem;
    }

    .answer-section strong {
      color: #065f46;
      font-size: 1.1rem;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      background: #667eea;
      color: white;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      transition: all 0.2s ease;
      margin-top: 1rem;
      font-family: inherit;
    }

    .btn:hover:not(:disabled) {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
    }

    .btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .explanation {
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
      padding: 1.5rem;
      margin-top: 1rem;
      border-radius: 8px;
    }

    .explanation p {
      margin: 0.5rem 0;
      color: #92400e;
      line-height: 1.8;
      white-space: pre-wrap;
    }

    .navigation {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }

    .navigation button {
      flex: 1;
      min-width: 120px;
    }

    /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
    .control-panel {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 1.5rem;
    }

    .control-panel h3 {
      font-size: 1rem;
      color: #374151;
      margin-bottom: 1rem;
    }

    .jump-section {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .jump-section input {
      width: 120px;
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
    }

    .jump-section input:focus {
      outline: none;
      border-color: #667eea;
    }

    /* ë¡œê·¸ì¸ ëª¨ë‹¬ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal {
      background: white;
      padding: 2rem;
      border-radius: 16px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal h2 {
      margin-bottom: 0.5rem;
      color: #1f2937;
      font-size: 1.5rem;
    }

    .modal p {
      color: #6b7280;
      margin-bottom: 1.5rem;
      font-size: 0.9rem;
    }

    .modal select {
      width: 100%;
      padding: 0.85rem 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 1rem;
      margin-bottom: 1rem;
      font-family: inherit;
      background: white;
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7280' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 1rem center;
    }

    .modal select:focus {
      outline: none;
      border-color: #667eea;
    }

    .modal .btn {
      width: 100%;
      margin-top: 0;
    }

    .modal .info-box {
      background: #f0fdf4;
      border: 1px solid #86efac;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1.5rem;
      font-size: 0.85rem;
      color: #166534;
    }

    .modal .error-box {
      background: #fef2f2;
      border: 1px solid #fca5a5;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1.5rem;
      font-size: 0.85rem;
      color: #991b1b;
    }

    /* ì˜¤ë‹µë…¸íŠ¸ ë²„íŠ¼ */
    .wrong-note-btn {
      margin-top: 1rem;
      padding: 0.75rem 1.5rem;
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.2s ease;
    }

    .wrong-note-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
    }

    /* ì˜¤ë‹µë…¸íŠ¸ íŒ¨ë„ */
    .wrong-notes-panel {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .wrong-notes-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .wrong-notes-header h3 {
      font-size: 1.2rem;
      color: #1f2937;
      margin: 0;
    }

    .wrong-notes-header .count {
      color: #6b7280;
      font-weight: normal;
    }

    .back-btn {
      background: #f3f4f6;
      border: none;
      border-radius: 8px;
      padding: 0.5rem 0.75rem;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .back-btn:hover {
      background: #e5e7eb;
    }

    /* í•„í„° ì„¹ì…˜ */
    .filter-section {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }

    .filter-btn {
      padding: 0.4rem 0.8rem;
      border: 2px solid #e5e7eb;
      border-radius: 20px;
      background: white;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.2s ease;
      font-family: inherit;
    }

    .filter-btn:hover {
      border-color: #667eea;
      background: #f5f3ff;
    }

    .filter-btn.active {
      border-color: #667eea;
      background: #667eea;
      color: white;
    }

    /* ì •ë ¬ ì„¹ì…˜ */
    .sort-section {
      margin-bottom: 1rem;
    }

    .sort-select {
      padding: 0.5rem 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.9rem;
      font-family: inherit;
      background: white;
      cursor: pointer;
    }

    .sort-select:focus {
      outline: none;
      border-color: #667eea;
    }

    /* ì˜¤ë‹µ ì¹´ë“œ */
    .wrong-cards {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .wrong-card {
      background: #fef3c7;
      border: 1px solid #fcd34d;
      border-radius: 12px;
      padding: 1rem;
      transition: all 0.2s ease;
    }

    .wrong-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(252, 211, 77, 0.3);
    }

    .wrong-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.75rem;
    }

    .question-id {
      font-weight: 700;
      color: #92400e;
      font-size: 0.9rem;
    }

    .wrong-card .services {
      display: flex;
      gap: 0.3rem;
      flex-wrap: wrap;
    }

    .wrong-card .service-tag {
      background: #fde68a;
      color: #92400e;
      padding: 0.2rem 0.5rem;
      border-radius: 10px;
      font-size: 0.7rem;
      font-weight: 500;
    }

    .question-preview {
      color: #78350f;
      font-size: 0.9rem;
      line-height: 1.5;
      margin-bottom: 0.75rem;
    }

    .wrong-card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .wrong-info {
      font-size: 0.8rem;
      color: #92400e;
    }

    .wrong-count {
      font-weight: 700;
      color: #dc2626;
    }

    .solve-btn {
      background: #f59e0b;
      color: white;
      border: none;
      padding: 0.4rem 1rem;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
    }

    .solve-btn:hover {
      background: #d97706;
    }

    /* ë¹ˆ ìƒíƒœ */
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #6b7280;
    }

    .empty-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    @media (max-width: 640px) {
      .header h1 {
        font-size: 1.3rem;
      }

      .header-content {
        flex-direction: column;
        gap: 0.5rem;
      }

      .quiz-container {
        padding: 1.5rem;
      }

      .navigation {
        flex-direction: column;
      }

      .navigation button {
        width: 100%;
      }

      .stats {
        grid-template-columns: repeat(2, 1fr);
      }

      .stat-card p {
        font-size: 1.3rem;
      }

      .mode-buttons {
        flex-direction: column;
      }

      .mode-btn {
        justify-content: center;
      }

      .wrong-note-btn {
        width: 100%;
        justify-content: center;
      }

      .wrong-card-header {
        flex-direction: column;
        gap: 0.5rem;
      }

      .wrong-card-footer {
        flex-direction: column;
        gap: 0.5rem;
        align-items: stretch;
      }

      .solve-btn {
        width: 100%;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
    <div class="modal-overlay" v-if="showLoginModal">
      <div class="modal">
        <h2>AWS SAA ìŠ¤í„°ë””</h2>
        <p>ì´ë¦„ì„ ì„ íƒí•˜ë©´ í’€ì´ ê¸°ë¡ì´ ì €ì¥ë©ë‹ˆë‹¤.</p>

        <div class="info-box" v-if="!loginError">
          ê¸°ë¡ì€ ìë™ìœ¼ë¡œ ì €ì¥ë˜ë©°, ë‚˜ì¤‘ì— ë³µìŠµí•  ë•Œ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>

        <div class="error-box" v-if="loginError">
          {{ loginError }}<br>
          <small style="opacity: 0.8;">ê¸°ë¡ì€ ì´ ê¸°ê¸°ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.</small>
        </div>

        <select v-model="selectedUser" :disabled="loadingUsers">
          <option value="" disabled>{{ loadingUsers ? 'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...' : 'ì´ë¦„ì„ ì„ íƒí•˜ì„¸ìš”' }}</option>
          <option v-for="user in users" :key="user.name" :value="user.name">
            {{ user.name }}
          </option>
        </select>

        <button class="btn" @click="login" :disabled="!selectedUser || loadingUsers">
          ì‹œì‘í•˜ê¸°
        </button>
      </div>
    </div>

    <div class="container">
      <!-- í—¤ë” -->
      <div class="header">
        <h1>AWS Solution Architect Associate</h1>
        <div class="header-content" v-if="currentUser">
          <div class="user-badge">
            {{ currentUser }}
            <button @click="logout" title="ë¡œê·¸ì•„ì›ƒ">âœ•</button>
          </div>
          <div class="sync-status" :class="syncStatusClass">
            <span>{{ syncStatusIcon }}</span> {{ syncStatusText }}
          </div>
        </div>
      </div>

      <!-- ë¡œë”© -->
      <div v-if="loading" class="loading">
        ë¬¸ì œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
      </div>

      <!-- ì—ëŸ¬ -->
      <div v-else-if="error" class="quiz-container">
        <p style="color: #ef4444; font-size: 1.2rem; text-align: center;">{{ error }}</p>
      </div>

      <!-- ë©”ì¸ ì½˜í…ì¸  -->
      <template v-else-if="currentUser">
        <!-- í’€ì´ ëª¨ë“œ ì„ íƒ -->
        <div class="mode-panel">
          <h3>í’€ì´ ëª¨ë“œ ì„ íƒ</h3>
          <div class="mode-buttons">
            <button
              class="mode-btn"
              :class="{ active: currentMode === 'sequential' }"
              @click="setMode('sequential')"
            >
              ìˆœì°¨
              <span class="count">{{ fullQuestions.length }}</span>
            </button>
            <button
              class="mode-btn"
              :class="{ active: currentMode === 'random' }"
              @click="setMode('random')"
            >
              ëœë¤
              <span class="count">{{ fullQuestions.length }}</span>
            </button>
            <button
              class="mode-btn"
              :class="{ active: currentMode === 'wrong' }"
              @click="setMode('wrong')"
            >
              ì˜¤ë‹µë³µìŠµ
              <span class="count">{{ wrongQuestions.length }}</span>
            </button>
            <button
              class="mode-btn"
              :class="{ active: currentMode === 'unsolved' }"
              @click="setMode('unsolved')"
            >
              ë¯¸í’€ì´
              <span class="count">{{ unsolvedQuestions.length }}</span>
            </button>
          </div>

          <!-- ì˜¤ë‹µë…¸íŠ¸ ë²„íŠ¼ -->
          <button class="wrong-note-btn" @click="showWrongNotes = true" v-if="wrongQuestions.length > 0">
            <span>ğŸ“‹</span> ì˜¤ë‹µë…¸íŠ¸ ({{ wrongQuestions.length }}ë¬¸ì œ)
          </button>
        </div>

        <!-- ì˜¤ë‹µë…¸íŠ¸ í™”ë©´ -->
        <div class="wrong-notes-panel" v-if="showWrongNotes">
          <div class="wrong-notes-header">
            <button class="back-btn" @click="showWrongNotes = false">â†</button>
            <h3>ğŸ“‹ ì˜¤ë‹µë…¸íŠ¸ <span class="count">({{ filteredWrongNotes.length }}ë¬¸ì œ)</span></h3>
          </div>

          <!-- ì„œë¹„ìŠ¤ í•„í„° -->
          <div class="filter-section">
            <button
              class="filter-btn"
              :class="{ active: wrongNoteFilter === 'all' }"
              @click="wrongNoteFilter = 'all'"
            >ì „ì²´</button>
            <button
              v-for="service in wrongNoteServices"
              :key="service"
              class="filter-btn"
              :class="{ active: wrongNoteFilter === service }"
              @click="wrongNoteFilter = service"
            >{{ service }} ({{ getWrongCountByService(service) }})</button>
          </div>

          <!-- ì •ë ¬ -->
          <div class="sort-section">
            <select class="sort-select" v-model="wrongNoteSort">
              <option value="count">ì˜¤ë‹µ ë§ì€ ìˆœ</option>
              <option value="recent">ìµœê·¼ ì˜¤ë‹µ ìˆœ</option>
              <option value="id">ë¬¸ì œ ë²ˆí˜¸ ìˆœ</option>
            </select>
          </div>

          <!-- ì˜¤ë‹µ ëª©ë¡ -->
          <div class="wrong-cards">
            <div class="wrong-card" v-for="item in filteredWrongNotes" :key="item.id">
              <div class="wrong-card-header">
                <span class="question-id">#{{ item.id }}</span>
                <div class="services">
                  <span class="service-tag" v-for="s in item.services" :key="s">{{ s }}</span>
                </div>
              </div>
              <p class="question-preview">{{ item.question.substring(0, 100) }}{{ item.question.length > 100 ? '...' : '' }}</p>
              <div class="wrong-card-footer">
                <span class="wrong-info">
                  ì˜¤ë‹µ <span class="wrong-count">{{ wrongNoteData[item.id]?.count || 1 }}íšŒ</span>
                  <span v-if="wrongNoteData[item.id]?.lastDate"> | ìµœê·¼: {{ wrongNoteData[item.id].lastDate }}</span>
                </span>
                <button class="solve-btn" @click="solveFromWrongNote(item.id)">í’€ê¸°</button>
              </div>
            </div>

            <!-- ë¹ˆ ìƒíƒœ -->
            <div class="empty-state" v-if="filteredWrongNotes.length === 0">
              <div class="empty-icon">ğŸ‰</div>
              <p v-if="wrongNoteFilter === 'all'">ì•„ì§ í‹€ë¦° ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!</p>
              <p v-else>{{ wrongNoteFilter }} ê´€ë ¨ ì˜¤ë‹µì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
          </div>
        </div>

        <!-- í†µê³„ -->
        <div class="stats" v-if="!showWrongNotes">
          <div class="stat-card">
            <h3>ì „ì²´ ë¬¸ì œ</h3>
            <p>{{ fullQuestions.length }}</p>
          </div>
          <div class="stat-card">
            <h3>í‘¼ ë¬¸ì œ</h3>
            <p style="color: #3b82f6;">{{ solvedQuestions.length }}</p>
          </div>
          <div class="stat-card">
            <h3>í‹€ë¦° ë¬¸ì œ</h3>
            <p style="color: #ef4444;">{{ wrongQuestions.length }}</p>
          </div>
          <div class="stat-card">
            <h3>ì •ë‹µë¥ </h3>
            <p style="color: #10b981;">{{ accuracyRate }}%</p>
          </div>
        </div>

        <!-- í€´ì¦ˆ -->
        <div class="quiz-container" v-if="questions.length > 0 && !showWrongNotes">
          <progress :value="current + 1" :max="questions.length"></progress>
          <div class="progress-info">
            <span>ì§„í–‰ë¥ : {{ current + 1 }} / {{ questions.length }}</span>
            <span>{{ formatTime(elapsedTime) }}</span>
          </div>

          <div v-if="question">
            <!-- AWS ì„œë¹„ìŠ¤ íƒœê·¸ -->
            <div class="service-tags" v-if="question.services && question.services.length">
              <span class="service-tag" v-for="service in question.services" :key="service">
                {{ service }}
              </span>
            </div>

            <p class="question">{{ question.question }}</p>

            <div v-for="(text, key) in question.choices" :key="key">
              <button
                class="choice-button"
                :class="buttonClass(key)"
                @click="toggleChoice(key)"
                :disabled="showAnswer"
              >
                {{ key }}. {{ text }}
              </button>
            </div>

            <div v-if="showAnswer" class="answer-section">
              <p><strong>ì •ë‹µ:</strong> {{ question.answers.join(', ') }}</p>
              <button class="btn" @click="showExplanation = true" v-if="!showExplanation">
                í•´ì„¤ ë³´ê¸°
              </button>
            </div>

            <div v-if="showExplanation" class="explanation">
              <p v-for="(exp, i) in question.explanations" :key="i">{{ exp }}</p>
            </div>

            <div class="navigation">
              <button class="btn" @click="prevQuestion" :disabled="current === 0">
                ì´ì „ ë¬¸ì œ
              </button>
              <button class="btn" @click="nextQuestion" :disabled="current + 1 === questions.length">
                ë‹¤ìŒ ë¬¸ì œ
              </button>
            </div>
          </div>
        </div>

        <!-- ë¬¸ì œ ì—†ìŒ -->
        <div class="quiz-container" v-else>
          <p style="text-align: center; color: #6b7280; padding: 2rem;">
            {{ currentMode === 'wrong' ? 'í‹€ë¦° ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!' : 'ë¯¸í’€ì´ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!' }}
          </p>
        </div>

        <!-- ë¬¸ì œ ë²ˆí˜¸ ì´ë™ -->
        <div class="control-panel" v-if="questions.length > 0">
          <h3>ë¬¸ì œ ë²ˆí˜¸ ì´ë™</h3>
          <div class="jump-section">
            <input
              type="number"
              v-model.number="jumpNumber"
              placeholder="ë²ˆí˜¸ ì…ë ¥"
              min="1"
              :max="questions.length"
              @keyup.enter="jumpTo"
            />
            <button class="btn" @click="jumpTo">ì´ë™</button>
          </div>
        </div>
      </template>
    </div>
  </div>

  <script>
    const { createApp } = Vue;

    // ========================================
    // ì„¤ì • - Google Apps Script ì›¹ì•± URLì„ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”
    // ========================================
    const API_URL = 'https://script.google.com/macros/s/AKfycbycc9-5yDo0IaUeqVYzudPZvv7JkdVfB5DwrPzbMubLTG-k1QPx2VwJRgRhe-78L5XGtg/exec';

    createApp({
      data() {
        return {
          // ë¡œë”© ìƒíƒœ
          loading: true,
          loadingUsers: true,
          error: null,
          loginError: null,

          // ì‚¬ìš©ì
          users: [],
          selectedUser: '',
          currentUser: localStorage.getItem('aws-quiz-user') || null,
          showLoginModal: !localStorage.getItem('aws-quiz-user'),

          // ì„¸ì…˜
          sessionId: this.generateSessionId(),

          // ë¬¸ì œ ë°ì´í„°
          fullQuestions: [],
          questions: [],
          current: 0,

          // ì‚¬ìš©ì í†µê³„
          solvedQuestions: [],
          wrongQuestions: [],

          // í˜„ì¬ ë¬¸ì œ ìƒíƒœ
          selectedChoices: [],
          showAnswer: false,
          showExplanation: false,

          // ëª¨ë“œ
          currentMode: 'sequential',
          modeNames: {
            'sequential': 'ìˆœì°¨',
            'random': 'ëœë¤',
            'wrong': 'ì˜¤ë‹µë³µìŠµ',
            'unsolved': 'ë¯¸í’€ì´'
          },

          // íƒ€ì´ë¨¸
          elapsedTime: 0,
          timerInterval: null,
          questionStartTime: null,

          // ë™ê¸°í™” ìƒíƒœ
          syncStatus: 'offline', // 'syncing', 'success', 'error', 'offline'

          // ê¸°íƒ€
          jumpNumber: null,
          attemptCounts: {}, // ë¬¸ì œë³„ ì‹œë„ íšŸìˆ˜

          // ì˜¤ë‹µë…¸íŠ¸
          showWrongNotes: false,
          wrongNoteData: {}, // { questionId: { count: ì˜¤ë‹µíšŸìˆ˜, lastDate: ìµœê·¼ì˜¤ë‹µì¼ } }
          wrongNoteFilter: 'all', // 'all' ë˜ëŠ” ì„œë¹„ìŠ¤ëª…
          wrongNoteSort: 'count' // 'count', 'recent', 'id'
        };
      },

      computed: {
        question() {
          return this.questions[this.current];
        },

        unsolvedQuestions() {
          return this.fullQuestions.filter(q => !this.solvedQuestions.includes(q.id));
        },

        accuracyRate() {
          if (this.solvedQuestions.length === 0) return 0;
          const correct = this.solvedQuestions.length - this.wrongQuestions.length;
          return Math.round((correct / this.solvedQuestions.length) * 100);
        },

        syncStatusClass() {
          return this.syncStatus;
        },

        syncStatusIcon() {
          const icons = {
            'syncing': 'â—',
            'success': 'â—',
            'error': 'â—',
            'offline': 'â—‹'
          };
          return icons[this.syncStatus] || 'â—‹';
        },

        syncStatusText() {
          const texts = {
            'syncing': 'ì €ì¥ ì¤‘...',
            'success': 'ì €ì¥ ì™„ë£Œ',
            'error': 'ì €ì¥ ì‹¤íŒ¨',
            'offline': 'ì˜¤í”„ë¼ì¸'
          };
          return texts[this.syncStatus] || 'ì˜¤í”„ë¼ì¸';
        },

        // ì˜¤ë‹µë…¸íŠ¸: í•„í„°ë§ëœ ì˜¤ë‹µ ëª©ë¡
        filteredWrongNotes() {
          let wrongItems = this.fullQuestions.filter(q => this.wrongQuestions.includes(q.id));

          // ì„œë¹„ìŠ¤ í•„í„°
          if (this.wrongNoteFilter !== 'all') {
            wrongItems = wrongItems.filter(q =>
              q.services && q.services.includes(this.wrongNoteFilter)
            );
          }

          // ì •ë ¬
          switch (this.wrongNoteSort) {
            case 'count':
              wrongItems.sort((a, b) =>
                (this.wrongNoteData[b.id]?.count || 1) - (this.wrongNoteData[a.id]?.count || 1)
              );
              break;
            case 'recent':
              wrongItems.sort((a, b) => {
                const dateA = this.wrongNoteData[a.id]?.lastDate || '0000-00-00';
                const dateB = this.wrongNoteData[b.id]?.lastDate || '0000-00-00';
                return dateB.localeCompare(dateA);
              });
              break;
            case 'id':
              wrongItems.sort((a, b) => a.id - b.id);
              break;
          }

          return wrongItems;
        },

        // ì˜¤ë‹µë…¸íŠ¸: ì„œë¹„ìŠ¤ ëª©ë¡
        wrongNoteServices() {
          const services = new Set();
          this.fullQuestions
            .filter(q => this.wrongQuestions.includes(q.id))
            .forEach(q => {
              if (q.services) {
                q.services.forEach(s => services.add(s));
              }
            });
          return Array.from(services).sort();
        }
      },

      async mounted() {
        // ë¬¸ì œ ë°ì´í„° ë¡œë“œ
        await this.loadQuestions();

        // ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ
        await this.loadUsers();

        // ì´ë¯¸ ë¡œê·¸ì¸ëœ ê²½ìš° ì‚¬ìš©ì í†µê³„ ë¡œë“œ
        if (this.currentUser) {
          await this.loadUserStats();
          this.startTimer();
        }
      },

      beforeUnmount() {
        this.stopTimer();
      },

      methods: {
        // ========================================
        // ìœ í‹¸ë¦¬í‹°
        // ========================================
        generateSessionId() {
          return 'sess_' + Math.random().toString(36).substring(2, 11);
        },

        formatTime(seconds) {
          const min = Math.floor(seconds / 60).toString().padStart(2, '0');
          const sec = Math.floor(seconds % 60).toString().padStart(2, '0');
          const ms = Math.floor((seconds % 1) * 100).toString().padStart(2, '0');
          return `${min}:${sec}.${ms}`;
        },

        shuffleArray(array) {
          const shuffled = [...array];
          for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
          }
          return shuffled;
        },

        // ========================================
        // ë°ì´í„° ë¡œë“œ
        // ========================================
        async loadQuestions() {
          try {
            const response = await fetch('./questions.json');
            if (!response.ok) throw new Error('ë¬¸ì œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            this.fullQuestions = await response.json();
            this.questions = [...this.fullQuestions];
            this.loading = false;
          } catch (err) {
            this.error = err.message;
            this.loading = false;
          }
        },

        async loadUsers() {
          this.loadingUsers = true;

          // API URLì´ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° ë¡œì»¬ ëª¨ë“œ
          if (API_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
            this.users = [{ name: 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì' }];
            this.loadingUsers = false;
            this.syncStatus = 'offline';
            return;
          }

          try {
            const response = await fetch(`${API_URL}?action=getUsers`, {
              method: 'GET',
              redirect: 'follow'
            });
            const result = await response.json();

            if (result.success) {
              this.users = result.users;
              this.syncStatus = 'success';
            } else {
              throw new Error(result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
            }
          } catch (err) {
            console.error('ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', err);
            this.loginError = 'ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì‹œì‘í•©ë‹ˆë‹¤.';
            this.users = [{ name: 'ê²ŒìŠ¤íŠ¸' }];
            this.syncStatus = 'offline';
          }

          this.loadingUsers = false;
        },

        async loadUserStats() {
          // ì˜¤ë‹µë…¸íŠ¸ ë°ì´í„° ë¡œë“œ
          this.loadWrongNoteData();

          if (API_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¡œë“œ
            const saved = localStorage.getItem(`aws-quiz-stats-${this.currentUser}`);
            if (saved) {
              const stats = JSON.parse(saved);
              this.solvedQuestions = stats.solvedQuestions || [];
              this.wrongQuestions = stats.wrongQuestions || [];
              this.attemptCounts = stats.attemptCounts || {};
            }
            return;
          }

          try {
            const response = await fetch(`${API_URL}?action=getUserStats&userName=${encodeURIComponent(this.currentUser)}`);
            const result = await response.json();

            if (result.success) {
              this.solvedQuestions = result.stats.solvedQuestions || [];
              this.wrongQuestions = result.stats.wrongQuestions || [];

              // ì‹œë„ íšŸìˆ˜ ê³„ì‚°
              this.solvedQuestions.forEach(id => {
                this.attemptCounts[id] = (this.attemptCounts[id] || 0) + 1;
              });
            }
          } catch (err) {
            console.error('ì‚¬ìš©ì í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', err);
          }
        },

        // ========================================
        // ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
        // ========================================
        async login() {
          if (!this.selectedUser) return;

          this.currentUser = this.selectedUser;
          localStorage.setItem('aws-quiz-user', this.currentUser);
          this.showLoginModal = false;
          this.sessionId = this.generateSessionId();

          await this.loadUserStats();
          this.startTimer();
        },

        logout() {
          if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            this.stopTimer();
            this.currentUser = null;
            localStorage.removeItem('aws-quiz-user');
            this.showLoginModal = true;
            this.selectedUser = '';
            this.solvedQuestions = [];
            this.wrongQuestions = [];
            this.attemptCounts = {};
            this.resetState();
            this.setMode('sequential');
          }
        },

        // ========================================
        // íƒ€ì´ë¨¸
        // ========================================
        startTimer() {
          this.questionStartTime = Date.now();
          this.elapsedTime = 0;
          this.timerInterval = setInterval(() => {
            this.elapsedTime = (Date.now() - this.questionStartTime) / 1000;
          }, 100);
        },

        stopTimer() {
          if (this.timerInterval) {
            clearInterval(this.timerInterval);
            this.timerInterval = null;
          }
          // ì •í™•í•œ ì†Œìš”ì‹œê°„ ê³„ì‚° (ì†Œìˆ˜ì  2ìë¦¬)
          this.elapsedTime = Math.round((Date.now() - this.questionStartTime) / 10) / 100;
        },

        resetTimer() {
          this.questionStartTime = Date.now();
          this.elapsedTime = 0;
        },

        // ========================================
        // ëª¨ë“œ ë³€ê²½
        // ========================================
        setMode(mode) {
          this.currentMode = mode;
          this.current = 0;
          this.resetState();

          switch (mode) {
            case 'sequential':
              this.questions = [...this.fullQuestions];
              break;
            case 'random':
              this.questions = this.shuffleArray([...this.fullQuestions]);
              break;
            case 'wrong':
              this.questions = this.fullQuestions.filter(q => this.wrongQuestions.includes(q.id));
              break;
            case 'unsolved':
              this.questions = this.fullQuestions.filter(q => !this.solvedQuestions.includes(q.id));
              break;
          }

          this.resetTimer();
        },

        // ========================================
        // ë¬¸ì œ í’€ì´
        // ========================================
        toggleChoice(choice) {
          if (this.showAnswer) return;

          const correctCount = this.question.answers.length;

          if (this.selectedChoices.includes(choice)) {
            this.selectedChoices = this.selectedChoices.filter(c => c !== choice);
          } else {
            if (this.selectedChoices.length >= correctCount) return;
            this.selectedChoices.push(choice);
          }

          if (this.selectedChoices.length === correctCount) {
            this.submitAnswer();
          }
        },

        async submitAnswer() {
          this.showAnswer = true;

          const selectedSorted = [...this.selectedChoices].sort().join(',');
          const correctSorted = [...this.question.answers].sort().join(',');
          const isCorrect = selectedSorted === correctSorted;

          // ì‹œë„ íšŸìˆ˜ ì—…ë°ì´íŠ¸
          this.attemptCounts[this.question.id] = (this.attemptCounts[this.question.id] || 0) + 1;

          // í†µê³„ ì—…ë°ì´íŠ¸
          if (!this.solvedQuestions.includes(this.question.id)) {
            this.solvedQuestions.push(this.question.id);
          }

          if (!isCorrect) {
            if (!this.wrongQuestions.includes(this.question.id)) {
              this.wrongQuestions.push(this.question.id);
            }
          } else {
            // ë§ì¶˜ ê²½ìš° ì˜¤ë‹µ ëª©ë¡ì—ì„œ ì œê±°
            this.wrongQuestions = this.wrongQuestions.filter(id => id !== this.question.id);
          }

          // ì˜¤ë‹µë…¸íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸
          this.updateWrongNoteData(this.question.id, isCorrect);

          // ê²°ê³¼ ì €ì¥
          await this.saveQuizResult(isCorrect);
        },

        async saveQuizResult(isCorrect) {
          // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
          const stats = {
            solvedQuestions: this.solvedQuestions,
            wrongQuestions: this.wrongQuestions,
            attemptCounts: this.attemptCounts
          };
          localStorage.setItem(`aws-quiz-stats-${this.currentUser}`, JSON.stringify(stats));

          // APIê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° ë¡œì»¬ ëª¨ë“œ
          if (API_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
            return;
          }

          this.syncStatus = 'syncing';

          try {
            // ì„ ì§€ í¬ë§·íŒ…: ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„
            const choicesText = Object.entries(this.question.choices)
              .map(([key, val]) => `${key}. ${val}`)
              .join('\n');

            // í•´ì„¤ í¬ë§·íŒ…: ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„
            const explanationText = (this.question.explanations || []).join('\n\n');

            const payload = {
              action: 'saveQuizResult',
              userName: this.currentUser,
              sessionId: this.sessionId,
              mode: this.modeNames[this.currentMode],
              questionId: this.question.id,
              questionText: this.question.question,
              choices: choicesText,
              questionType: this.question.answers.length > 1 ? 'ë³µìˆ˜ì„ íƒ' : 'ë‹¨ì¼ì„ íƒ',
              services: this.question.services || [],
              selectedAnswers: this.selectedChoices,
              correctAnswers: this.question.answers,
              explanation: explanationText,
              isCorrect: isCorrect,
              elapsedTime: this.elapsedTime,
              attemptCount: this.attemptCounts[this.question.id]
            };

            // Google Apps ScriptëŠ” form ë°ì´í„°ë¡œ ì „ì†¡í•´ì•¼ CORS ìš°íšŒ ê°€ëŠ¥
            const formData = new FormData();
            formData.append('payload', JSON.stringify(payload));

            await fetch(API_URL, {
              method: 'POST',
              body: formData
            });

            this.syncStatus = 'success';
          } catch (err) {
            console.error('ì €ì¥ ì‹¤íŒ¨:', err);
            this.syncStatus = 'error';
          }
        },

        buttonClass(choice) {
          if (!this.showAnswer) {
            return this.selectedChoices.includes(choice) ? 'selected' : '';
          }
          const isCorrect = this.question.answers.includes(choice);
          const isSelected = this.selectedChoices.includes(choice);
          if (isCorrect) return 'correct';
          if (isSelected && !isCorrect) return 'incorrect';
          return '';
        },

        // ========================================
        // ë„¤ë¹„ê²Œì´ì…˜
        // ========================================
        nextQuestion() {
          if (this.current + 1 < this.questions.length) {
            this.current++;
            this.resetState();
            this.resetTimer();
          }
        },

        prevQuestion() {
          if (this.current > 0) {
            this.current--;
            this.resetState();
            this.resetTimer();
          }
        },

        jumpTo() {
          if (this.jumpNumber && this.jumpNumber >= 1 && this.jumpNumber <= this.questions.length) {
            this.current = this.jumpNumber - 1;
            this.resetState();
            this.resetTimer();
            this.jumpNumber = null;
          } else {
            alert('ì˜¬ë°”ë¥¸ ë¬¸ì œ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
          }
        },

        resetState() {
          this.selectedChoices = [];
          this.showAnswer = false;
          this.showExplanation = false;
        },

        // ========================================
        // ì˜¤ë‹µë…¸íŠ¸
        // ========================================
        getWrongCountByService(service) {
          return this.fullQuestions.filter(q =>
            this.wrongQuestions.includes(q.id) &&
            q.services && q.services.includes(service)
          ).length;
        },

        solveFromWrongNote(questionId) {
          // ì˜¤ë‹µë…¸íŠ¸ ë‹«ê¸°
          this.showWrongNotes = false;

          // í•´ë‹¹ ë¬¸ì œ ì°¾ê¸°
          const questionIndex = this.fullQuestions.findIndex(q => q.id === questionId);
          if (questionIndex === -1) return;

          // ìˆœì°¨ ëª¨ë“œë¡œ ì „í™˜í•˜ê³  í•´ë‹¹ ë¬¸ì œë¡œ ì´ë™
          this.currentMode = 'sequential';
          this.questions = [...this.fullQuestions];
          this.current = questionIndex;
          this.resetState();
          this.resetTimer();
        },

        updateWrongNoteData(questionId, isCorrect) {
          const today = new Date().toISOString().slice(0, 10);

          if (!isCorrect) {
            // ì˜¤ë‹µì¸ ê²½ìš° ì¹´ìš´íŠ¸ ì¦ê°€
            if (!this.wrongNoteData[questionId]) {
              this.wrongNoteData[questionId] = { count: 0, lastDate: today };
            }
            this.wrongNoteData[questionId].count++;
            this.wrongNoteData[questionId].lastDate = today;
          }

          // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
          localStorage.setItem(
            `aws-quiz-wrongnote-${this.currentUser}`,
            JSON.stringify(this.wrongNoteData)
          );
        },

        loadWrongNoteData() {
          const saved = localStorage.getItem(`aws-quiz-wrongnote-${this.currentUser}`);
          if (saved) {
            this.wrongNoteData = JSON.parse(saved);
          }
        }
      }
    }).mount('#app');
  </script>
</body>
</html>
